<?xml version="1.0" encoding="UTF-8"?>
<XGenConfig>
 <Model>
    <ModelAttributeInjections>
      <!-- Override the owner attribute with dbo, since it is now filled with the database name. -->
      <ModelAttributeInjection modelXPath="//system[@name='AVS']/mappableObjects/entity" targetAttribute="owner" targetValue="dbo"/>
      <!-- Flip the name and the code column for AVS. -->
      <ModelAttributeInjection modelXPath="//system[@name='AVS']/mappableObjects/entity" targetAttribute="originalName" targetXPath="@id"/>
      <ModelAttributeInjection modelXPath="//system[@name='AVS']/mappableObjects/entity" targetAttribute="id" targetXPath="@name"/>
      <ModelAttributeInjection modelXPath="//system[@name='AVS']/mappableObjects/entity" targetAttribute="name" targetXPath="@originalName"/>
      <ModelAttributeInjection modelXPath="//system[@name='AVS']/mappableObjects/entity/attributes/attribute" targetAttribute="originalName" targetXPath="@id"/>
      <ModelAttributeInjection modelXPath="//system[@name='AVS']/mappableObjects/entity/attributes/attribute" targetAttribute="id" targetXPath="@name"/>
      <ModelAttributeInjection modelXPath="//system[@name='AVS']/mappableObjects/entity/attributes/attribute" targetAttribute="name" targetXPath="@originalName"/>
      <ModelAttributeInjection modelXPath="//system[@name='AVS']/mappableObjects/entity/keys/uniqueKey/keyColumns/keyColumn" targetAttribute="originalName" targetXPath="@id"/>
      <ModelAttributeInjection modelXPath="//system[@name='AVS']/mappableObjects/entity/keys/uniqueKey/keyColumns/keyColumn" targetAttribute="id" targetXPath="@name"/>
      <ModelAttributeInjection modelXPath="//system[@name='AVS']/mappableObjects/entity/keys/uniqueKey/keyColumns/keyColumn" targetAttribute="name" targetXPath="@originalName"/>      
    </ModelAttributeInjections>
  </Model>
  <TextTemplate rootSectionName="uniqueKey">
    <FileFormat currentAccessor="_" childAccessor="$" singleLineCommentPrefix="--" annotationPrefix="@XGen" annotationArgsPrefix="(" annotationArgsSuffix=")" />
    <Output type="output_per_element" />
  </TextTemplate>
  <Binding>


  <SectionModelBinding section="uniqueKey" modelXPath="/modeldefinition/system/mappableObjects/entity/keys/uniqueKey">
      <Placeholders>
  			<Placeholder name="system" modelXPath="../../../.." />
        <Placeholder name="table" modelXPath="../.." />        
  		</Placeholders>

    <SectionModelBinding section="uniqueKeyColumn" modelXPath="keyColumns/keyColumn" variableName="keyColumn">
      	<Placeholders>
  				<Placeholder name="keyColumn" modelXPath="../../../../attributes/attribute[@id=$keyColumn/@id]" />     
  			</Placeholders>
    </SectionModelBinding>

    <SectionModelBinding section="keyColumn" modelXPath="../../../attributes/attribute[(@primary='true')]">
        <Placeholders>
          <Placeholder name="table" modelXPath="../.." />
        </Placeholders>
    </SectionModelBinding>

    <SectionModelBinding section="nonKeyColumn" modelXPath="../../attributes/attribute[not(@primary='true') and not(lower-case(@computed)='true')]">
        <Placeholders>
          <Placeholder name="table" modelXPath="../.." />
        </Placeholders>
    </SectionModelBinding>

    <SectionModelBinding section="nonKeyComputedColumn" modelXPath="../../attributes/attribute[lower-case(@computed)='true']">
      <Placeholders>
        <Placeholder name="table" modelXPath="../.." />
      </Placeholders>
    </SectionModelBinding>

 	</SectionModelBinding>          

  </Binding>
</XGenConfig>