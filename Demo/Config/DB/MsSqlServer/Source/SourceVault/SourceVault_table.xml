<?xml version="1.0" encoding="UTF-8"?>
<XGenConfig>
 <Model>
    <ModelAttributeInjections>
      <!-- Override the owner attribute with dbo, since it is now filled with the database name. -->
      <ModelAttributeInjection modelXPath="//system[@name='AVS']/mappableObjects/entity" targetAttribute="owner" targetValue="dbo"/>
      <!-- Flip the name and the code column for AVS. -->
      <ModelAttributeInjection modelXPath="//system[@name='AVS']/mappableObjects/entity" targetAttribute="originalName" targetXPath="@id"/>
      <ModelAttributeInjection modelXPath="//system[@name='AVS']/mappableObjects/entity" targetAttribute="id" targetXPath="@name"/>
      <ModelAttributeInjection modelXPath="//system[@name='AVS']/mappableObjects/entity" targetAttribute="name" targetXPath="@originalName"/>
      <ModelAttributeInjection modelXPath="//system[@name='AVS']/mappableObjects/entity/attributes/attribute" targetAttribute="originalName" targetXPath="@id"/>
      <ModelAttributeInjection modelXPath="//system[@name='AVS']/mappableObjects/entity/attributes/attribute" targetAttribute="id" targetXPath="@name"/>
      <ModelAttributeInjection modelXPath="//system[@name='AVS']/mappableObjects/entity/attributes/attribute" targetAttribute="name" targetXPath="@originalName"/>
      <!-- Zet datatype voor Lava.ContactMethode.Waarde op nvarchar(100). -->
      <ModelAttributeInjection modelXPath="/modeldefinition/system[@name='Lava']/mappableObjects/entity[@name='ContactMethode']/attributes/attribute[@name='Waarde']" targetAttribute="fulldatatype" targetValue="nvarchar(100)"/>
      <ModelAttributeInjection modelXPath="/modeldefinition/system[@name='Lava']/mappableObjects/entity[@name='ContactMethode']/attributes/attribute[@name='Waarde']" targetAttribute="length" targetValue="100"/>
      <!-- Lava: Override the length of the fields where the length is max to 1000. -->
      <ModelAttributeInjection modelXPath="//attributes/attribute[lower-case(@fulldatatype) = 'nvarchar(max)']" targetAttribute="fulldatatype" targetValue="nvarchar(1000)"/>
      <!-- MsCrm: Override the length of the field new_begeleidendetekst where the length is max to 4000. -->
      <ModelAttributeInjection modelXPath="/modeldefinition/system[@name='MsCrm']/mappableObjects/entity[@name='Filterednew_communicatiekanaaltekst']/attributes/attribute[@name='new_begeleidendetekst']" targetAttribute="fulldatatype" targetValue="nvarchar(4000)"/> 	  
      <!-- Override the fulldatatype for timestamp and rowversion to binary. -->
      <ModelAttributeInjection modelXPath="//attributes/attribute[@datatype='rowversion' or @datatype='timestamp']" targetAttribute="fulldatatype" targetValue="binary(8)"/>
    </ModelAttributeInjections>
  </Model>
  <TextTemplate rootSectionName="table">
    <FileFormat currentAccessor="_" childAccessor="$" singleLineCommentPrefix="--" annotationPrefix="@XGen" annotationArgsPrefix="(" annotationArgsSuffix=")" />
    <Output type="output_per_element" />
  </TextTemplate>
  <Binding>
		<SectionModelBinding section="table" modelXPath="/modeldefinition/system/mappableObjects/entity">
			<Placeholders>
				<Placeholder name="system" modelXPath="../.." />
			</Placeholders>

      <SectionModelBinding section="keyColumn" modelXPath="attributes/attribute[@primary='true']">
        <Placeholders>
          <Placeholder name="table" modelXPath="../.." />
        </Placeholders>
      </SectionModelBinding>
      <SectionModelBinding section="nonKeyColumn" modelXPath="attributes/attribute[not(@primary='true') and not(lower-case(@computed)='true')]">
        <Placeholders>
          <Placeholder name="table" modelXPath="../.." />
        </Placeholders>
      </SectionModelBinding>
      <SectionModelBinding section="nonKeyComputedColumn" modelXPath="attributes/attribute[lower-case(@computed)='true']">
        <Placeholders>
          <Placeholder name="table" modelXPath="../.." />
        </Placeholders>
      </SectionModelBinding>

      <SectionModelBinding section="businessKeyColumn" modelXPath="attributes/businessKey" />
      <SectionModelBinding section="ignore" modelXPath=".[0=1]" />

     <!--To support 1 stored procedure template that contains both scenario's we need to duplicate the above, nesting it per @loadStrategy  -->
      <SectionModelBinding section="updateDelete" modelXPath=".[@loadStrategy='InsertUpdateDelete']" placeholderName='table'>
        <Placeholders>
  				<Placeholder name="system" modelXPath="../.." />
			  </Placeholders>
        <SectionModelBinding section="keyColumn" modelXPath="attributes/attribute[@primary='true']" />
        <SectionModelBinding section="nonKeyColumn" modelXPath="attributes/attribute[not(@primary='true') and not(lower-case(@computed)='true')]" />
        <SectionModelBinding section="nonKeyComputedColumn" modelXPath="attributes/attribute[lower-case(@computed)='true']" />        
      </SectionModelBinding>

      <SectionModelBinding section="update" modelXPath=".[@loadStrategy='InsertUpdate']" placeholderName='table'>      
        <Placeholders>
  				<Placeholder name="system" modelXPath="../.." />
			  </Placeholders>
        <SectionModelBinding section="keyColumn" modelXPath="attributes/attribute[@primary='true']" />
        <SectionModelBinding section="nonKeyColumn" modelXPath="attributes/attribute[not(@primary='true') and not(lower-case(@computed)='true')]" />
        <SectionModelBinding section="nonKeyComputedColumn" modelXPath="attributes/attribute[lower-case(@computed)='true']" />                
      </SectionModelBinding>

		</SectionModelBinding>
  </Binding>
</XGenConfig>